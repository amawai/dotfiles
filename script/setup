#!/bin/bash
apt-get update
apt-get install vim -y

git config --global pager.branch false
git config --global core.editor "vim"

# Use ZSH as the default shell
if command -v zsh; then
  chsh -s $(which zsh)
  
  if [ ! -d "~/zsh-syntax-highlighting" ] ; then
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ~/zsh-syntax-highlighting
    echo "source ~/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh" >> ${ZDOTDIR:-$HOME}/.zshrc
  fi
fi

if command -v brew; then
  test -d /home/linuxbrew/.linuxbrew && eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
  test -r ~/.zshrc && echo "eval \"\$($(brew --prefix)/bin/brew shellenv)\"" >>~/.zshrc
  echo "eval \"\$($(brew --prefix)/bin/brew shellenv)\"" >>~/.profile

  if ! grep -Fq "p10k-instant-prompt" ~/.zshrc; then
    brew install romkatv/powerlevel10k/powerlevel10k
    echo "source $(brew --prefix)/opt/powerlevel10k/powerlevel10k.zsh-theme" >>~/.zshrc

    cp ./.p10k.zsh ~/.p10k.zsh

    sed -i '1iif [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then\n  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"\nfi' ~/.zshrc
    echo "[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh" >> ~/.zshrc
  fi
#else (doesn't work at the moment)
#  # Settle with using zsh if no brew since brew takes 5ever
#  apt install zsh -yq
#  sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh) --unattended"
#  zsh
fi

if command -v zsh; then
  source ~/.zshrc
fi
